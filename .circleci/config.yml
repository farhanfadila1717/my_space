version: 2.1
orbs:
  android: circleci/android@1.0.3
  flutter: circleci/flutter@1.0
jobs:
  distribute:
    executor:
      name: android/android-machine
    steps:
      - run:
        command: |
            mkdir ~/development && cd $_
            if [ "$(uname)" == 'Darwin' ]; then
              curl -o flutter_sdk.zip https://storage.googleapis.com/flutter_infra_release/releases/stable/macos/flutter_macos_<<parameters.version>>-stable.zip
              unzip -qq flutter_sdk.zip
            elif [ "$(expr substr $(uname -s) 1 5)" == 'Linux' ]; then
              curl -o flutter_sdk.tar.xz https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_<<parameters.version>>-stable.tar.xz
              tar xf flutter_sdk.tar.xz
            else
              echo "Your platform ($(uname -a)) is not supported."
              exit 1
            fi
            echo 'export PATH=~/development/flutter/bin:$PATH' >> $BASH_ENV
        name: Install Flutter SDK
      - run: flutter doctor
workflows:
  distribute:
    jobs:
      - distribute